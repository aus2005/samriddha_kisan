{% extends 'layout.html' %}

{% block title %}
  {{ post.title }}
{% endblock %}

{% block content %}
<div class="post-container">
  {% if post.banner %}
    <img class="banner" src="{{ post.banner.url }}" alt="{{ post.title }} image" />
  {% endif %}

  <h1>{{ post.title }}</h1>
  <p>{{ post.date }}</p>
  <p>{{ post.author }}</p>
  <p><strong>श्रेणी:</strong> {{ post.get_category_display }}</p>
  <hr />
  <p>{{ post.body }}</p>
  <hr />

  {% if user.is_authenticated %}
    <form action="{% url 'posts:toggle-like' slug=post.slug %}" method="post">
      {% csrf_token %}
      <button type="submit" class="form-submit">
        {% if user in post.likes.all %}
          <!-- Filled icon -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="30" height="30">
            <!-- icon path -->
          </svg>
        {% else %}
          <!-- Outline icon -->
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="30" height="30">
            <!-- icon path -->
          </svg>
        {% endif %}
        ({{ post.likes.count }})
      </button>
    </form>
  {% else %}
    <p>लाइक गर्नको लागि तपाईंले लग इन गर्नुपर्छ।</p>
    <button class="login-button" onclick="window.location.href='{% url 'users:login' %}'">लगइन</button>
  {% endif %}
</div>

<br />

<div class="reply-container">
  <h2>प्रतिक्रियाहरू</h2>

  {% for reply in replies %}
    <div style="margin-bottom: 1rem; padding-left: 1rem; border-left: 2px solid #ccc;">
      <p>{{ reply.body }}</p>
      <p><small>{{ reply.author }}</small></p>
      <p><small>{{ reply.date }}</small></p>

      {% if user.is_authenticated %}
        <form method="post" action="{% url 'posts:like-reply' reply.id %}">
          {% csrf_token %}
          <button type="submit" class="form-submit">
            {% if user in reply.likes.all %}
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="30" height="30">
                <!-- icon path -->
              </svg>
            {% else %}
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="30" height="30">
                <!-- icon path -->
              </svg>
            {% endif %}
            ({{ reply.total_likes }})
          </button>
        </form>
      {% else %}
        <p>लाइक गर्नको लागि तपाईंले लग इन गर्नुपर्छ।</p>
        <button class="login-button" onclick="window.location.href='{% url 'users:login' %}'">लगइन</button>
      {% endif %}
    </div>
  {% empty %}
    <h3>कुनै प्रतिक्रियाहरू छैनन्।</h3>
  {% endfor %}

  <hr />
  <h2>प्रतिक्रिया लेख्नुहोस्</h2>

  {% if user.is_authenticated %}
    <form method="post" class="reply">
      {% csrf_token %}
      {{ reply_form.as_p }}
      <button class="form-submit">पेश गर्नुहोस्</button>
    </form>
  {% else %}
    <p>प्रतिक्रिया छोड्नको लागि तपाईंले लग इन गर्नुपर्छ।</p>
    <button class="login-button" onclick="window.location.href='{% url 'users:login' %}'">लगइन</button>
  {% endif %}
</div>
{% endblock %}
